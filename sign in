import 'package:flutter/material.dart';
import 'sign_in_page.dart';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Login System',
      theme: ThemeData(
        colorScheme: ColorScheme.fromSeed(seedColor: Colors.deepPurple),
        useMaterial3: true,
      ),
      home: const SignInPage(),
    );
  }
}
import 'package:flutter/material.dart';
import 'file_service.dart';
import 'home_page.dart';
import 'sign-up.dart';
import 'sign_in_page.dart';
import 'reset_password_page.dart';

class SignInPage extends StatefulWidget {
  const SignInPage({super.key});

  @override
  State<SignInPage> createState() => _SignInPageState();
}

class _SignInPageState extends State<SignInPage> {
  final _usernameController = TextEditingController();
  final _passwordController = TextEditingController();
  bool _isLoading = false;

  Future<void> _login() async {
    final username = _usernameController.text.trim();
    final password = _passwordController.text.trim();

    if (username.isEmpty || password.isEmpty) {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(content: Text('Please fill in all fields')),
      );
      return;
    }

    setState(() {
      _isLoading = true;
    });

    final isValid = await FileService.checkValue(username, password);

    setState(() {
      _isLoading = false;
    });

    if (isValid) {
      if (mounted) {
        Navigator.pushReplacement(
          context,
          MaterialPageRoute(
            builder: (context) => HomePage(username: username),
          ),
        );
      }
    } else {
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(content: Text('Invalid username or password')),
        );
      }
    }
  }

  @override
  void dispose() {
    _usernameController.dispose();
    _passwordController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Sign In'),
        backgroundColor: Theme.of(context).colorScheme.inversePrimary,
      ),
      body: Center(
        child: Padding(
          padding: const EdgeInsets.all(16.0),
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              TextField(
                controller: _usernameController,
                decoration: const InputDecoration(
                  labelText: 'Username',
                  border: OutlineInputBorder(),
                ),
              ),
              const SizedBox(height: 16),
              TextField(
                controller: _passwordController,
                decoration: const InputDecoration(
                  labelText: 'Password',
                  border: OutlineInputBorder(),
                ),
                obscureText: true,
              ),
              const SizedBox(height: 24),
              _isLoading
                  ? const CircularProgressIndicator()
                  : ElevatedButton(
                onPressed: _login,
                style: ElevatedButton.styleFrom(
                  padding: const EdgeInsets.symmetric(
                    horizontal: 32,
                    vertical: 16,
                  ),
                ),
                child: const Text('Login'),
              ),
              const SizedBox(height: 16),
              TextButton(
                onPressed: () {
                  Navigator.push(
                    context,
                    MaterialPageRoute(
                      builder: (context) => const SignUpPage(),
                    ),
                  );
                },
                child: const Text('Don\'t ŸáŸÑ ŸÑÿØŸäŸÉ ÿ≠ÿ≥ÿßÿ®ÿü Sign Up'),
              ),
              const SizedBox(height: 8),
              TextButton(
                onPressed: () {
                  Navigator.push(
                    context,
                    MaterialPageRoute(
                      builder: (context) => const ResetPasswordPage(),
                    ),
                  );
                },
                child: const Text('Reset Password'),
              ),
            ],
          ),
        ),
      ),
    );
  }
}
import 'package:flutter/material.dart';
import 'file_service.dart';
import 'home_page.dart';

class ResetPasswordPage extends StatefulWidget {
  const ResetPasswordPage({super.key});

  @override
  State<ResetPasswordPage> createState() => _ResetPasswordPageState();
}

class _ResetPasswordPageState extends State<ResetPasswordPage> {
  final _usernameController = TextEditingController();
  final _oldPasswordController = TextEditingController();
  final _newPasswordController = TextEditingController();
  bool _isLoading = false;

  Future<void> _resetPassword() async {
    final username = _usernameController.text.trim();
    final oldPassword = _oldPasswordController.text.trim();
    final newPassword = _newPasswordController.text.trim();

    if (username.isEmpty || oldPassword.isEmpty || newPassword.isEmpty) {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(content: Text('Please fill in all fields')),
      );
      return;
    }

    setState(() {
      _isLoading = true;
    });

    // Check if username and old password are correct
    final isValid = await FileService.checkValue(username, oldPassword);

    if (!isValid) {
      setState(() {
        _isLoading = false;
      });
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(content: Text('Invalid username or old password')),
        );
      }
      return;
    }

    // Get user department
    final department = await FileService.getUserDepartment(username);

    if (department == null) {
      setState(() {
        _isLoading = false;
      });
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(content: Text('User not found')),
        );
      }
      return;
    }

    // Update password using save() function
    final success = await FileService.save(username, newPassword, department);

    setState(() {
      _isLoading = false;
    });

    if (success) {
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(content: Text('Password updated successfully')),
        );
        Navigator.pushReplacement(
          context,
          MaterialPageRoute(
            builder: (context) => HomePage(username: username),
          ),
        );
      }
    } else {
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(content: Text('Failed to update password')),
        );
      }
    }
  }

  @override
  void dispose() {
    _usernameController.dispose();
    _oldPasswordController.dispose();
    _newPasswordController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Reset Password'),
        backgroundColor: Theme.of(context).colorScheme.inversePrimary,
      ),
      body: Center(
        child: Padding(
          padding: const EdgeInsets.all(16.0),
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              TextField(
                controller: _usernameController,
                decoration: const InputDecoration(
                  labelText: 'Username',
                  border: OutlineInputBorder(),
                ),
              ),
              const SizedBox(height: 16),
              TextField(
                controller: _oldPasswordController,
                decoration: const InputDecoration(
                  labelText: 'Old Password',
                  border: OutlineInputBorder(),
                ),
                obscureText: true,
              ),
              const SizedBox(height: 16),
              TextField(
                controller: _newPasswordController,
                decoration: const InputDecoration(
                  labelText: 'New Password',
                  border: OutlineInputBorder(),
                ),
                obscureText: true,
              ),
              const SizedBox(height: 24),
              _isLoading
                  ? const CircularProgressIndicator()
                  : ElevatedButton(
                onPressed: _resetPassword,
                style: ElevatedButton.styleFrom(
                  padding: const EdgeInsets.symmetric(
                    horizontal: 32,
                    vertical: 16,
                  ),
                ),
                child: const Text('Reset Password'),
              ),
            ],
          ),
        ),
      ),
    );
  }
}
import 'package:flutter/material.dart';
import 'file_service.dart';
import 'home_page.dart';

class SignUpPage extends StatefulWidget {
  const SignUpPage({super.key});

  @override
  State<SignUpPage> createState() => _SignUpPageState();
}

class _SignUpPageState extends State<SignUpPage> {
  final _usernameController = TextEditingController();
  final _passwordController = TextEditingController();
  final _departmentController = TextEditingController();
  bool _isLoading = false;

  Future<void> _save() async {
    final username = _usernameController.text.trim();
    final password = _passwordController.text.trim();
    final department = _departmentController.text.trim();

    if (username.isEmpty || password.isEmpty || department.isEmpty) {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(content: Text('Please fill in all fields')),
      );
      return;
    }

    setState(() {
      _isLoading = true;
    });

    final success = await FileService.save(username, password, department);

    setState(() {
      _isLoading = false;
    });

    if (success) {
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(content: Text('User registered successfully')),
        );
        Navigator.pushReplacement(
          context,
          MaterialPageRoute(
            builder: (context) => HomePage(username: username),
          ),
        );
      }
    } else {
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(content: Text('Failed to register user')),
        );
      }
    }
  }

  @override
  void dispose() {
    _usernameController.dispose();
    _passwordController.dispose();
    _departmentController.dispose();
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Sign Up'),
        backgroundColor: Theme.of(context).colorScheme.inversePrimary,
      ),
      body: Center(
        child: Padding(
          padding: const EdgeInsets.all(16.0),
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              TextField(
                controller: _usernameController,
                decoration: const InputDecoration(
                  labelText: 'Username',
                  border: OutlineInputBorder(),
                ),
              ),
              const SizedBox(height: 16),
              TextField(
                controller: _passwordController,
                decoration: const InputDecoration(
                  labelText: 'Password',
                  border: OutlineInputBorder(),
                ),
                obscureText: true,
              ),
              const SizedBox(height: 16),
              TextField(
                controller: _departmentController,
                decoration: const InputDecoration(
                  labelText: 'Department',
                  border: OutlineInputBorder(),
                ),
              ),
              const SizedBox(height: 24),
              _isLoading
                  ? const CircularProgressIndicator()
                  : ElevatedButton(
                onPressed: _save,
                style: ElevatedButton.styleFrom(
                  padding: const EdgeInsets.symmetric(
                    horizontal: 32,
                    vertical: 16,
                  ),
                ),
                child: const Text('Save'),
              ),
              const SizedBox(height: 16),
              TextButton(
                onPressed: () {
                  Navigator.pop(context);
                },
                child: const Text('Already have an account? Sign In'),
              ),
            ],
          ),
        ),
      ),
    );
  }
}
import 'dart:io';
import 'package:path_provider/path_provider.dart';

class FileService {
  static Future<File> _getFile() async {
    final directory = await getApplicationSupportDirectory();
    return File('${directory.path}/sign_file.txt');
  }

  // Check if username and password exist in the file
  static Future<bool> checkValue(String username, String password) async {
    try {
      final file = await _getFile();
      if (!await file.exists()) {
        print('üìÑ [DEV] File does not exist yet: ${file.path}');
        return false;
      }

      final content = await file.readAsString();
      print('üìÑ [DEV] File content (checkValue):\n$content');
      final lines = content.split('\n');

      for (var line in lines) {
        if (line.trim().isEmpty) continue;

        // Parse the line: username_ÿßŸÑÿßÿ≥ŸÖ, password_ÿßŸÑŸÉŸÑŸÖÿ©, department_ÿßŸÑÿ™ÿÆÿµÿµ
        final parts = line.split(', ');
        String? fileUsername;
        String? filePassword;

        for (var part in parts) {
          if (part.startsWith('username_')) {
            fileUsername = part.substring('username_'.length);
          } else if (part.startsWith('password_')) {
            filePassword = part.substring('password_'.length);
          }
        }

        if (fileUsername == username && filePassword == password) {
          return true;
        }
      }

      return false;
    } catch (e) {
      return false;
    }
  }

  // Save user data to the file
  static Future<bool> save(String username, String password, String department) async {
    try {
      final file = await _getFile();

      // Check if user already exists
      String content = '';
      if (await file.exists()) {
        content = await file.readAsString();
        final lines = content.split('\n');

        // Remove existing entry for this username if it exists
        final updatedLines = <String>[];
        for (var line in lines) {
          if (line.trim().isEmpty) continue;

          final parts = line.split(', ');
          String? fileUsername;

          for (var part in parts) {
            if (part.startsWith('username_')) {
              fileUsername = part.substring('username_'.length);
              break;
            }
          }

          if (fileUsername != username) {
            updatedLines.add(line);
          }
        }

        content = updatedLines.join('\n');
        if (content.isNotEmpty && !content.endsWith('\n')) {
          content += '\n';
        }
      }

      // Add new entry
      final newEntry = 'username_$username, password_$password, department_$department';
      content += newEntry;

      await file.writeAsString(content);
      print('üìù [DEV] File content after save:\n$content');
      print('üìÅ [DEV] File path: ${file.path}');
      return true;
    } catch (e) {
      return false;
    }
  }

  // Get user department by username
  static Future<String?> getUserDepartment(String username) async {
    try {
      final file = await _getFile();
      if (!await file.exists()) {
        print('üìÑ [DEV] File does not exist yet: ${file.path}');
        return null;
      }

      final content = await file.readAsString();
      print('üìÑ [DEV] File content (getUserDepartment):\n$content');
      final lines = content.split('\n');

      for (var line in lines) {
        if (line.trim().isEmpty) continue;

        final parts = line.split(', ');
        String? fileUsername;
        String? fileDepartment;

        for (var part in parts) {
          if (part.startsWith('username_')) {
            fileUsername = part.substring('username_'.length);
          } else if (part.startsWith('department_')) {
            fileDepartment = part.substring('department_'.length);
          }
        }

        if (fileUsername == username) {
          return fileDepartment;
        }
      }

      return null;
    } catch (e) {
      return null;
    }
  }
}
